{% extends "base.html" %}
{% load static %}

{% block title %}Home - Shrimati{% endblock title %}
{% block head %}
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="{% static 'assets/img/favicon.ico' %}">
  <style>
    /* Sticky Mega Menu */
    #topbar {
      position: sticky;
      top: 0;
      z-index: 0;
      background: #fff;
    }

    /* Dropdown always above banners */
    .dropdown-menu {
      position: absolute !important;
      z-index: 0 !important;
      min-width: 600px;
      background: #fff;
      border: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .mega-dropdown .row {
      width: 100%;
    }

    .mega-dropdown h6 {
      font-size: 14px;
      margin-bottom: 8px;
      color: #333;
    }

    .dropdown-item {
      font-size: 13px;
      padding: 4px 0;
      color: #555;
    }

    .dropdown-item:hover {
      color: #0d6efd;
      background: transparent;
    }

    .hero-container,
    .carousel {
      position: relative;
      z-index: 1;
    }
  </style>
  {% endblock %} 


<<!-- Mega Menu Content -->
<section id="topbar" class="topbar d-flex align-items-center mt-10">
  {% block mega_menu %}
  <nav class="navbar navbar-expand-lg navbar-light bg-white w-100 shadow-sm mt-5">
    <div class="container-fluid">

      <!-- Category Cards (Dynamic) -->
      <ul class="navbar-nav d-flex flex-row flex-nowrap overflow-auto w-100 justify-content-around category-scroll">

        {% for category in categories %}
        <li class="nav-item dropdown position-static text-center mx-2">
          <a class="nav-link fw-bold d-flex flex-column align-items-center text-dark px-2 py-2 dropdown-toggle"
             href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
             
            {% if category.image %}
              <img src="{{ category.image.url }}" class="rounded-circle shadow-sm mb-1"
                   style="width:50px; height:50px;" alt="{{ category.name }}">
            {% else %}
              <img src="{% static 'assets/img/default.jpeg' %}" class="rounded-circle shadow-sm mb-1"
                   style="width:50px; height:50px;" alt="{{ category.name }}">
            {% endif %}
            
            <span>{{ category.name }}</span>
          </a>

          <!-- Dropdown with SubCategories -->
          <div class="dropdown-menu w-100 mt-0 border-0 shadow-lg rounded-3 p-3">
            <div class="row">
              {% for sub in category.subcategories.all %}
              <div class="col-md-3">
                <h6 class="fw-bold text-dark">{{ sub.name }}</h6>
                <a class="dropdown-item" href="{% url 'products_by_subcategory' sub.id %}">
                  {{ sub.name }}
                </a>
              </div>
              {% empty %}
              <p class="text-muted">No subcategories</p>
              {% endfor %}
            </div>
          </div>
        </li>
        {% endfor %}

      </ul>
    </div>
  </nav>
  {% endblock %}
</section>


<!-- JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  if (window.innerWidth < 992) {
    document.querySelectorAll(".nav-item.dropdown > .nav-link").forEach(el => {
      el.addEventListener("click", function (e) {
        // Toggle only top category, not submenu items
        e.preventDefault();
        const menu = this.nextElementSibling;

        // Close all open menus first
        document.querySelectorAll(".dropdown-menu").forEach(m => {
          if (m !== menu) m.style.display = "none";
        });

        // Toggle current
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      });
    });

    // Allow normal clicks inside dropdown menu
    document.querySelectorAll(".dropdown-menu a").forEach(link => {
      link.addEventListener("click", function (e) {
        e.stopPropagation(); // donâ€™t close menu
        // let Django link work normally
      });
    });
  }
});
</script>

<!------>

      

{% block banner %}
<div class="hero-container" data-aos="fade-up ">
  <div id="bannerCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="{% static 'assets/img/bg.jpg' %}" class="d-block w-100" alt="Banner 1">
      </div>
      <div class="carousel-item">
        <img src="{% static 'assets/img/banner1.jpg' %}" class="d-block w-100" alt="Banner 2">
      </div>
      <div class="carousel-item">
        <img src="{% static 'assets/img/banner3.jpg' %}" class="d-block w-100" alt="Banner 3">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
    </button>
  </div>
</div>
{% endblock %}

{% block body %}
<!-- Products Section -->
<section id="products" class="portfolio section py-5">
  <div class="container section-title text-center" data-aos="fade-up">
    <h2>Our Products</h2>
    <p><span>Check Our</span> <span class="description-title">Catalogue</span></p>
  </div>

  <div class="container" data-aos="fade-up">
    {% if allProds %}
      {% for prods, slide_range, nSlides, cat in allProds %}
        {% if prods %}
          <h3 class="mt-5 mb-4">{{ cat.name }}</h3>
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            {% for product in prods %}
              <div class="col">
                <div class="card h-100 shadow-sm border-0 product-card">
                  <a href="{% url 'product_detail' product.id %}">
                    <img src="{{ product.image.url }}" class="card-img-top img-fluid product-img" alt="{{ product.name }}">
                  </a>
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ product.name }}</h5>
                    <p class="card-text text-muted small mb-2">{{ product.description|truncatewords:12 }}</p>
                    <div class="mt-auto d-flex justify-content-between align-items-center">
                      <span class="fw-bold text-success fs-5">â‚¹{{ product.price }}</span>
                      {% if product.offer %}
                        <span class="badge bg-danger">{{ product.offer }}% off</span>
                      {% endif %}
                    </div>
                  </div>
                  <div class="card-footer bg-white border-0 text-center">
                    <button class="btn btn-success w-100 add-cart-btn" data-id="{{ product.id }}">ðŸ›’ Add to Cart</button>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
    {% else %}
      <p class="text-center">No products available.</p>
    {% endif %}
  </div>
</section>

<style>
/* Product Card Hover */
.product-card {
  margin-top: 10px;
  transition: transform 0.3s, box-shadow 0.3s;
}
.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

/* Product Image */
.product-img {
  height: 200px;
  object-fit: cover;
  border-radius: 5px;
}

/* Add to Cart Button Full Width on Small Devices */
@media (max-width: 576px) {
  .product-card .add-cart-btn {
    font-size: 0.9rem;
    padding: 0.4rem 0;

  }
.product-card img {
  width: 100%;
  height: auto;   /* keeps original aspect ratio */
  object-fit: contain; /* ensures full image shows */
  border-radius: 8px;  
</style>

<!-- Services Section -->
<section id="services" class="services section bg-light py-5">
  <div class="container section-title text-center" data-aos="fade-up">
    <h2>Our Services</h2>
    <p>We provide premium services with a personal touch</p>
  </div>
  <div class="container">
    <div class="row g-4">
      <div class="col-md-4" data-aos="fade-up">
        <div class="card shadow h-100 text-center p-4">
          <i class="bi bi-truck fs-1 text-success"></i>
          <h5 class="mt-3">Fast Delivery</h5>
          <p class="text-muted">Quick and safe delivery of all your products.</p>
        </div>
      </div>
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
        <div class="card shadow h-100 text-center p-4">
          <i class="bi bi-headset fs-1 text-success"></i>
          <h5 class="mt-3">24/7 Support</h5>
          <p class="text-muted">Our support is available round the clock.</p>
        </div>
      </div>
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
        <div class="card shadow h-100 text-center p-4">
          <i class="bi bi-shield-check fs-1 text-success"></i>
          <h5 class="mt-3">Quality Guarantee</h5>
          <p class="text-muted">We provide only the highest quality products.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Process Section -->
<section id="process" class="process section bg-light py-5">
  <div class="container text-center" data-aos="fade-up">
    <h2 class="mb-4">Our Pure & Natural Process</h2>
    <p class="mb-5">From farm to table, every step is natural, traditional, and chemical-free.</p>
    <div class="row g-4">
      <div class="col-md-3" data-aos="fade-up">
        <div class="card shadow-sm p-3 h-100">
          <img src="{% static 'assets/img/process/harvesting.jpg' %}" class="rounded mb-3" style="height:150px; object-fit:cover;" alt="Harvesting">
          <h5>Harvesting</h5>
          <p class="small text-muted">Harvested directly from local farms.</p>
        </div>
      </div>
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="100">
        <div class="card shadow-sm p-3 h-100">
          <img src="{% static 'assets/img/process/Infographic-style-process-diagram.jpeg' %}" class="rounded mb-3" style="height:150px; object-fit:cover;" alt="Preparation">
          <h5>Traditional Preparation</h5>
          <p class="small text-muted">Juice boiled naturally without chemicals.</p>
        </div>
      </div>
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="200">
        <div class="card shadow-sm p-3 h-100">
          <img src="{% static 'assets/img/process/Cooked.jpg' %}" class="rounded mb-3" style="height:150px; object-fit:cover;" alt="Processing">
          <h5>Processing</h5>
          <p class="small text-muted">Cooked and shaped by hand using traditional methods.</p>
        </div>
      </div>
      <div class="col-md-3" data-aos="fade-up" data-aos-delay="300">
        <div class="card shadow-sm p-3 h-100">
          <img src="{% static 'assets/img/process/Harvesting.jpg' %}" class="rounded mb-3" style="height:150px; object-fit:cover;" alt="Pure Jaggery">
          <h5>Pure Jaggery</h5>
          <p class="small text-muted">Final natural product, ready for you.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Testimonials Section -->
<section id="testimonials" class="testimonials section bg-light py-5">
  <div class="container" data-aos="fade-up">
    <div class="section-title text-center mb-5">
      <h2>What Our Customers Say</h2>
      <p>Real stories from our satisfied customers</p>
    </div>
    <div id="testimonialCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="card shadow-sm border-0 p-4 text-center mx-auto" style="max-width:700px;">
            <img src="{% static 'assets/img/customers/customer1.jpg' %}" class="rounded-circle mb-3 mx-auto" width="100" height="100" alt="Customer 1">
            <h6 class="mb-0">Ravi Kumar</h6>
            <small class="text-muted">Delhi</small>
            <div class="text-warning my-2">
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star-half-alt"></i>
            </div>
            <p class="card-text mt-2">"Amazing quality products! I loved the jaggery, it feels organic and pure. Highly recommended."</p>
          </div>
        </div>
        <div class="carousel-item">
          <div class="card shadow-sm border-0 p-4 text-center mx-auto" style="max-width:700px;">
            <img src="{% static 'assets/img/customers/customer2.jpg' %}" class="rounded-circle mb-3 mx-auto" width="100" height="100" alt="Customer 2">
            <h6 class="mb-0">Priya Sharma</h6>
            <small class="text-muted">Noida</small>
            <div class="text-warning my-2">
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <p class="card-text mt-2">"Great taste and packaging. My family enjoys it every day. The delivery was also quick."</p>
          </div>
        </div>
        <div class="carousel-item">
          <div class="card shadow-sm border-0 p-4 text-center mx-auto" style="max-width:700px;">
            <img src="{% static 'assets/img/customers/customer3.jpg' %}" class="rounded-circle mb-3 mx-auto" width="100" height="100" alt="Customer 3">
            <h6 class="mb-0">Amit Verma</h6>
            <small class="text-muted">Lucknow</small>
            <div class="text-warning my-2">
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="far fa-star"></i>
            </div>
            <p class="card-text mt-2">"Healthy, tasty, and pure. Reminds me of traditional jaggery made at home. Keep it up!"</p>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon bg-dark rounded-circle p-2"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon bg-dark rounded-circle p-2"></span>
      </button>
    </div>
  </div>
</section>

<!-- Blog Section -->
<section id="blog" class="blog section bg-light py-5">
  <div class="container section-title text-center" data-aos="fade-up">
    <h2>Latest Blog</h2>
    <p>Stay updated with our news and articles</p>
  </div>
  <div class="container">
    <div class="row g-4">
      <div class="col-md-4" data-aos="fade-up">
        <div class="card shadow h-100">
          <img src="{% static 'assets/img/blog1.jpg' %}" class="card-img-top" alt="Blog 1">
          <div class="card-body">
            <h5 class="card-title">How to Choose the Best Organic Products</h5>
            <p class="card-text text-muted">Tips and tricks to ensure youâ€™re buying the best.</p>
            <a href="#" class="btn btn-outline-primary btn-sm">Read More</a>
          </div>
        </div>
      </div>
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
        <div class="card shadow h-100">
          <img src="{% static 'assets/img/blog2.jpg' %}" class="card-img-top" alt="Blog 2">
          <div class="card-body">
            <h5 class="card-title">Top 10 Healthy Lifestyle Habits</h5>
            <p class="card-text text-muted">Simple changes that can improve your lifestyle.</p>
            <a href="#" class="btn btn-outline-primary btn-sm">Read More</a>
          </div>
        </div>
      </div>
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
        <div class="card shadow h-100">
          <img src="{% static 'assets/img/blog3.jpg' %}" class="card-img-top" alt="Blog 3">
          <div class="card-body">
            <h5 class="card-title">Why Customers Love Shrimati</h5>
            <p class="card-text text-muted">Discover what makes our store unique.</p>
            <a href="#" class="btn btn-outline-primary btn-sm">Read More</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Attach click listeners to all Add to Cart buttons
    document.querySelectorAll('.add-cart-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const productId = this.dataset.id;
            const url = `/add-to-cart/${productId}/`; // match your Django path

            fetch(url)
            .then(response => response.json())
            .then(data => {
                // Update cart count in navbar (if exists)
                const cartCount = document.getElementById('cart-count');
                if (cartCount) {
                    cartCount.textContent = data.cart_count;
                }

                // Optionally: show a temporary message
                btn.textContent = "Added âœ…";
                setTimeout(() => {
                    btn.textContent = "ðŸ›’ Add to Cart";
                }, 1000);
            })
            .catch(error => console.error('Error adding to cart:', error));
        });
    });
});
</script>
{% endblock %}
